---
import "../styles/MasonryLayout.css";
import { getImage } from "astro:assets";
import { resolveImage } from "../utils/imageMap";
const { images } = Astro.props;
const imageAssets = await Promise.all(
  images.map(async (image) => {
    if (image) {
      try {
        const resolvedSrc = resolveImage(image.src);
        return await getImage({
          src: resolvedSrc,
          alt: image.alt,
          width: 3840,
          height: 2160,
          decoding: "async",
          format: "avif",
          loading: "lazy",
        });
      } catch (error) {
        console.warn(`Skipping image in gallery:`, error.message);
        return null;
      }
    }
    return null;
  }),
);
---

<div class="masonry not-prose">
  {
    imageAssets.map((imageAsset, index) =>
      imageAsset ? (
        <div class="image-container" id="gallery">
          <a href={imageAsset.src} class="image-link glightbox">
            <img
              src={imageAsset.src}
              alt={imageAsset.attributes.alt}
              loading={imageAsset.attributes.loading}
              decoding={imageAsset.attributes.decoding}
              width={imageAsset.attributes.width}
              height={imageAsset.attributes.height}
              class="image"
            />
          </a>
        </div>
      ) : null,
    )
  }
</div>
<script src="../scripts/lightbox.js"></script>
